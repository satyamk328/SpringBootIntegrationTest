<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RestResponseEntityExceptionHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">test</a> &gt; <a href="index.source.html" class="el_package">com.test.controller</a> &gt; <span class="el_source">RestResponseEntityExceptionHandler.java</span></div><h1>RestResponseEntityExceptionHandler.java</h1><pre class="source lang-java linenums">package com.test.controller;

import java.util.ArrayList;
import java.util.List;

import javax.validation.ConstraintViolationException;

import org.springframework.beans.ConversionNotSupportedException;
import org.springframework.dao.DataIntegrityViolationException;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.http.converter.HttpMessageNotReadableException;
import org.springframework.http.converter.HttpMessageNotWritableException;
import org.springframework.validation.BindException;
import org.springframework.validation.FieldError;
import org.springframework.validation.ObjectError;
import org.springframework.web.HttpMediaTypeNotAcceptableException;
import org.springframework.web.HttpMediaTypeNotSupportedException;
import org.springframework.web.HttpRequestMethodNotSupportedException;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.MissingPathVariableException;
import org.springframework.web.bind.MissingServletRequestParameterException;
import org.springframework.web.bind.ServletRequestBindingException;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.context.request.WebRequest;
import org.springframework.web.context.request.async.AsyncRequestTimeoutException;
import org.springframework.web.method.annotation.MethodArgumentTypeMismatchException;
import org.springframework.web.multipart.support.MissingServletRequestPartException;
import org.springframework.web.servlet.NoHandlerFoundException;
import org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler;

import com.test.exception.BusinessException;
import com.text.request.model.RestCustom;
import com.text.request.model.RestResponse;
import com.text.request.model.RestStatus;

import lombok.extern.slf4j.Slf4j;

/**
 * 
 * 
 * @author Satyam Kumar
 *
 */
@ControllerAdvice
<span class="fc" id="L48">@Slf4j</span>
<span class="fc" id="L49">public class RestResponseEntityExceptionHandler extends ResponseEntityExceptionHandler {</span>

	@ExceptionHandler(value = { BusinessException.class })
	protected ResponseEntity&lt;Object&gt; handleBussinessException(BusinessException ex) {
<span class="fc" id="L53">		log.error(ex.getMessage());</span>
		
<span class="fc" id="L55">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="fc" id="L56">				new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, ex.getLocalizedMessage()),</span>
<span class="fc" id="L57">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="fc" id="L58">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>

	}

	
	@ExceptionHandler(DataIntegrityViolationException.class)
	protected ResponseEntity&lt;Object&gt; handleDataIntegrityViolation(DataIntegrityViolationException ex,
			WebRequest request) {
<span class="nc" id="L66">		log.error(ex.getMessage());</span>
		
<span class="nc bnc" id="L68" title="All 2 branches missed.">		if (ex.getCause() instanceof ConstraintViolationException) {</span>
<span class="nc" id="L69">			RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L70">					new RestStatus&lt;&gt;(HttpStatus.CONFLICT, &quot;Database error&quot;));</span>
<span class="nc" id="L71">			return new ResponseEntity&lt;&gt;(response, HttpStatus.CONFLICT);</span>
		}
<span class="nc" id="L73">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L74">				new RestStatus&lt;&gt;(HttpStatus.CONFLICT, ex.getLocalizedMessage()),</span>
<span class="nc" id="L75">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L76">		return new ResponseEntity&lt;&gt;(response, HttpStatus.CONFLICT);</span>
	}

	@ExceptionHandler(value = { Exception.class })
	protected ResponseEntity&lt;Object&gt; handleConflict(Exception ex, WebRequest request) {
<span class="nc" id="L81">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L83">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L84">				new RestStatus&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR, &quot;Internal Server Error while performing Operation&quot;),</span>
<span class="nc" id="L85">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L86">		return new ResponseEntity&lt;&gt;(response, HttpStatus.INTERNAL_SERVER_ERROR);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleHttpRequestMethodNotSupported(HttpRequestMethodNotSupportedException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L92">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L94">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L95">				new RestStatus&lt;&gt;(HttpStatus.METHOD_NOT_ALLOWED, ex.getMessage()),</span>
<span class="nc" id="L96">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L97">		return new ResponseEntity&lt;&gt;(response, HttpStatus.METHOD_NOT_ALLOWED);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleHttpMediaTypeNotSupported(HttpMediaTypeNotSupportedException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L103">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L105">		StringBuilder builder = new StringBuilder();</span>
<span class="nc" id="L106">		builder.append(ex.getContentType());</span>
<span class="nc" id="L107">		builder.append(&quot; media type is not supported. Supported media types are &quot;);</span>
<span class="nc" id="L108">		ex.getSupportedMediaTypes().forEach(t -&gt; builder.append(t).append(&quot;, &quot;));</span>

<span class="nc" id="L110">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L111">				new RestStatus&lt;&gt;(HttpStatus.UNSUPPORTED_MEDIA_TYPE, builder.substring(0, builder.length() - 2)),</span>
<span class="nc" id="L112">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L113">		return new ResponseEntity&lt;&gt;(response, HttpStatus.UNSUPPORTED_MEDIA_TYPE);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleHttpMediaTypeNotAcceptable(HttpMediaTypeNotAcceptableException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L119">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L121">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L122">				new RestStatus&lt;&gt;(HttpStatus.NOT_ACCEPTABLE, ex.getMessage()),</span>
<span class="nc" id="L123">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L124">		return new ResponseEntity&lt;&gt;(response, HttpStatus.NOT_ACCEPTABLE);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleMissingPathVariable(MissingPathVariableException ex, HttpHeaders headers,
			HttpStatus status, WebRequest request) {
<span class="nc" id="L130">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L132">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L133">				new RestStatus&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR, ex.getMessage()),</span>
<span class="nc" id="L134">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L135">		return new ResponseEntity&lt;&gt;(response, HttpStatus.INTERNAL_SERVER_ERROR);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleMissingServletRequestParameter(MissingServletRequestParameterException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L141">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L143">		String error = ex.getParameterName() + &quot; parameter is missing&quot;;</span>
<span class="nc" id="L144">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null, new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, error),</span>
<span class="nc" id="L145">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L146">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleServletRequestBindingException(ServletRequestBindingException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L152">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L154">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L155">				new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, ex.getMessage()),</span>
<span class="nc" id="L156">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L157">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleConversionNotSupported(ConversionNotSupportedException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L163">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L165">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L166">				new RestStatus&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR, ex.getMessage()),</span>
<span class="nc" id="L167">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L168">		return new ResponseEntity&lt;&gt;(response, HttpStatus.INTERNAL_SERVER_ERROR);</span>
	}

	@ExceptionHandler(MethodArgumentTypeMismatchException.class)
	protected ResponseEntity&lt;Object&gt; handleMethodArgumentTypeMismatch(MethodArgumentTypeMismatchException ex,
			WebRequest request) {
<span class="fc" id="L174">		log.error(ex.getMessage());</span>
		
<span class="fc" id="L176">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="fc" id="L177">				new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST,</span>
<span class="fc" id="L178">						String.format(&quot;The parameter '%s' of value '%s' could not be converted to type '%s'&quot;,</span>
<span class="fc" id="L179">								ex.getName(), ex.getValue(), ex.getRequiredType().getSimpleName())),</span>
<span class="fc" id="L180">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="fc" id="L181">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleHttpMessageNotReadable(HttpMessageNotReadableException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L187">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L189">		String error = &quot;Unable to parse JSON request&quot;;</span>
<span class="nc" id="L190">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null, new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, error),</span>
<span class="nc" id="L191">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L192">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleHttpMessageNotWritable(HttpMessageNotWritableException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L198">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L200">		String error = &quot;Error writing JSON output&quot;;</span>
<span class="nc" id="L201">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L202">				new RestStatus&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR, error),</span>
<span class="nc" id="L203">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L204">		return new ResponseEntity&lt;&gt;(response, HttpStatus.INTERNAL_SERVER_ERROR);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleMethodArgumentNotValid(MethodArgumentNotValidException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="fc" id="L210">		log.error(ex.getMessage());</span>
		
<span class="fc" id="L212">		List&lt;String&gt; errors = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L213" title="All 2 branches covered.">		for (FieldError error : ex.getBindingResult().getFieldErrors()) {</span>
<span class="fc" id="L214">			errors.add(error.getField() + &quot;: &quot; + error.getDefaultMessage());</span>
		}
<span class="pc bpc" id="L216" title="1 of 2 branches missed.">		for (ObjectError error : ex.getBindingResult().getGlobalErrors()) {</span>
<span class="nc" id="L217">			errors.add(error.getObjectName() + &quot;: &quot; + error.getDefaultMessage());</span>
		}

<span class="fc" id="L220">		RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="fc" id="L221">				new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, errors.toString()),</span>
<span class="fc" id="L222">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="fc" id="L223">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleMissingServletRequestPart(MissingServletRequestPartException ex,
			HttpHeaders headers, HttpStatus status, WebRequest request) {
<span class="nc" id="L229">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L231">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L232">				new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, ex.getMessage()),</span>
<span class="nc" id="L233">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L234">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleBindException(BindException ex, HttpHeaders headers, HttpStatus status,
			WebRequest request) {
<span class="nc" id="L240">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L242">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L243">				new RestStatus&lt;&gt;(HttpStatus.BAD_REQUEST, ex.getMessage()),</span>
<span class="nc" id="L244">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L245">		return new ResponseEntity&lt;&gt;(response, HttpStatus.BAD_REQUEST);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleNoHandlerFoundException(NoHandlerFoundException ex, HttpHeaders headers,
			HttpStatus status, WebRequest request) {
<span class="nc" id="L251">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L253">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L254">				new RestStatus&lt;&gt;(HttpStatus.NOT_FOUND, ex.getMessage()),</span>
<span class="nc" id="L255">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L256">		return new ResponseEntity&lt;&gt;(response, HttpStatus.NOT_FOUND);</span>
	}

	@Override
	protected ResponseEntity&lt;Object&gt; handleAsyncRequestTimeoutException(AsyncRequestTimeoutException ex,
			HttpHeaders headers, HttpStatus status, WebRequest webRequest) {
<span class="nc" id="L262">		log.error(ex.getMessage());</span>
		
<span class="nc" id="L264">		final RestResponse&lt;String&gt; response = new RestResponse&lt;&gt;(null,</span>
<span class="nc" id="L265">				new RestStatus&lt;&gt;(HttpStatus.SERVICE_UNAVAILABLE, ex.getMessage()),</span>
<span class="nc" id="L266">				RestCustom.builder().cause(ex.toString()).build());</span>
<span class="nc" id="L267">		return new ResponseEntity&lt;&gt;(response, HttpStatus.SERVICE_UNAVAILABLE);</span>
	}
}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>